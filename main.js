var board=null,views=[];$(function(){board=new Board(document.querySelector("#contentWrap")),board.setSort("DESC"),$("#font_family").on("change",function(){document.execCommand("FontName",!1,$(this).val()),$(selectedLastElement).find("font").each(function(){"돋움"==$(this).attr("face")&&$(this).css("font-family","돋움"),"돋움체"==$(this).attr("face")&&$(this).css("font-family","돋움체"),"굴림"==$(this).attr("face")&&$(this).css("font-family","굴림"),"굴림체"==$(this).attr("face")&&$(this).css("font-family","굴림체"),"바탕체"==$(this).attr("face")&&$(this).css("font-family","바탕체"),$(this).removeAttr("face")})}),$("#font_size").on("change",function(){document.execCommand("fontSize",!1,$(this).val()),$(selectedLastElement).find("font").each(function(){1==$(this).attr("size")&&($(this).css("font-size","10px"),$(this).css("line-height","10px")),2==$(this).attr("size")&&($(this).css("font-size","12px"),$(this).css("line-height","12px")),3==$(this).attr("size")&&($(this).css("font-size","14px"),$(this).css("line-height","14px")),4==$(this).attr("size")&&($(this).css("font-size","16px"),$(this).css("line-height","16px")),5==$(this).attr("size")&&($(this).css("font-size","20px"),$(this).css("line-height","20px")),6==$(this).attr("size")&&($(this).css("font-size","30px"),$(this).css("line-height","30px")),7==$(this).attr("size")&&($(this).css("font-size","40px"),$(this).css("line-height","40px")),$(this).removeAttr("size")})}),$("#font_color").on("change",function(){document.execCommand("foreColor",!1,$(this).val()),$(selectedLastElement).find("font").each(function(){$(this).css("color",$(this).attr("color")),$(this).removeAttr("color")})}),$("#font_bold").on("click",function(){document.execCommand("bold",!1,!0)}),$("#font_underline").on("click",function(){document.execCommand("underline",!1,!0)}),$("#font_italic").on("click",function(){document.execCommand("italic",!1,!0)})});
function DataLoad(E){for(var e=E.split("|^@4@^|"),t=new View,A=new Page(t),a=null,P=null,r=0;r<e.length;r++){var _=e[r].split("|^@3@^|");switch(_[0]){case"PAGE_NAMEVALUE":for(var l=_[1].split("|^@2@^|"),s=0;s<l.length;s++){var G=l[s].split("|^@1@^|");G[1]&&(A[G[0]]=G[1])}A.createPropertyElement();break;case"PANEL_NAMEVALUE":a=new Panel(A);for(var l=_[1].split("|^@2@^|"),s=0;s<l.length;s++){var G=l[s].split("|^@1@^|");G[1]&&(a[G[0]]=G[1])}a.createPropertyElement(),A.panels.push(a);break;case"ITEM_NAMEVALUE":P=new Item(a);for(var l=_[1].split("|^@2@^|"),s=0;s<l.length;s++){var G=l[s].split("|^@1@^|");G[1]&&(P[G[0]]=G[1])}P.createPropertyElement(),a.items.push(P)}}t.pages.push(A),views.push(t)}$(function(){GetCommandArgs("PAGE_KEY|^@^|00001|^@@^|PAGE_TITLE|^@^|00002|^@@^|PAGE_LOCKED|^@^|0","PAGE_KEY,PAGE_TITLE,PAGE_DATE,PAGE_TIME,PAGE_KIND,PAGE_LOCKED,PAGE_LOCKEDNAME,PAGE_SIGN,VIEW_KIND,PAGE_SELECT,PAGE_MODIFIED,REG_NAME,PAGE_INOUT,PAGE_DEPT,PAGE_PRINT,PAGE_PRINTNAME");DataLoad(data)});
function GetCommandArgs(r,e){var t=e.toUpperCase().split(","),a=new Array;if(r&&r.length>0){for(var n=r.split("|^@@^|"),l=0;l<n.length;l++){var o=n[l].split("|^@^|");a[o[0].toUpperCase()]=o[1]}for(var l=0;l<t.length;l++)t[l]=a[t[l]],t[l]||(t[l]="")}else for(var l=0;l<t.length;l++)t[l]="";return t}
var data="PAGE_NAMEVALUE|^@3@^|Key|^@1@^|1213|^@2@^|Title|^@1@^|경과기록지|^@2@^|Style|^@1@^|0|^@2@^|Date|^@1@^|2016-08-05|^@2@^|Time|^@1@^|13:41:13|^@2@^|IsPrintable|^@1@^|true|^@2@^|HeadPrint|^@1@^|A|^@2@^|FootPrint|^@1@^|A|^@2@^|SheetKey|^@1@^|10|^@2@^|Value|^@1@^||^@4@^|PANEL_NAMEVALUE|^@3@^|PageKey|^@1@^|1213|^@2@^|Key|^@1@^|2|^@2@^|BackColor|^@1@^|rgba(255,255,255,1)|^@2@^|Width|^@1@^|720|^@2@^|Height|^@1@^|912|^@2@^|IsPrintable|^@1@^|true|^@2@^|ExpandTitle|^@1@^|경과기록지1|^@2@^|IsExpandable|^@1@^|false|^@2@^|IsExpanded|^@1@^|true|^@2@^|ExPageKey|^@1@^|9|^@2@^|IsPrintExpand|^@1@^|false|^@2@^|BackImageString|^@1@^||^@2@^|BackImageWidth|^@1@^|720|^@2@^|RunPageAdd|^@1@^||^@2@^|RunPageLoad|^@1@^||^@2@^|RunPageSave|^@1@^||^@2@^|IsUserSizable|^@1@^|true|^@2@^|UserMinHeight|^@1@^|225|^@2@^|UserMaxHeight|^@1@^|1000|^@2@^|Value|^@1@^||^@2@^|BackImageAngle|^@1@^|0|^@4@^|ITEM_NAMEVALUE|^@3@^|PageKey|^@1@^|1213|^@2@^|PanelKey|^@1@^|2|^@2@^|ParentItemKey|^@1@^|-1|^@2@^|Key|^@1@^|1|^@2@^|DataKey|^@1@^|1|^@2@^|Style|^@1@^|1|^@2@^|Edit|^@1@^|true|^@2@^|IsSelectable|^@1@^|false|^@2@^|IsPrintable|^@1@^|true|^@2@^|X|^@1@^|1|^@2@^|Y|^@1@^|1|^@2@^|Width|^@1@^|718|^@2@^|Height|^@1@^|910|^@2@^|Angle|^@1@^|0|^@2@^|BackColor|^@1@^|rgba(255,255,255,0)|^@2@^|BackImageString|^@1@^||^@2@^|BorderColor|^@1@^|rgba(0,0,0,1)|^@2@^|BorderWidth|^@1@^|0|^@2@^|BorderDash|^@1@^||^@2@^|InLineStyle|^@1@^|0|^@2@^|InLineColor|^@1@^|rgba(0,0,0,1)|^@2@^|InLineDash|^@1@^||^@2@^|InLineWidth|^@1@^|1|^@2@^|InLineCap|^@1@^|butt|^@2@^|Checked|^@1@^|false|^@2@^|CheckGroup|^@1@^||^@2@^|CheckBoxStyle|^@1@^|1|^@2@^|CheckBoxAlign|^@1@^|1|^@2@^|CheckBoxColor|^@1@^|rgba(0,0,0,1)|^@2@^|CheckBoxWidth|^@1@^|12|^@2@^|CheckBoxHeight|^@1@^|12|^@2@^|CheckBoxLineWidth|^@1@^|1|^@2@^|CheckStyle|^@1@^|1|^@2@^|CheckValue|^@1@^||^@2@^|CheckForeColor|^@1@^|rgba(0,0,0,1)|^@2@^|CheckBackColor|^@1@^|rgba(255,255,255,0)|^@2@^|CheckLineWidth|^@1@^|2|^@2@^|UnCheckStyle|^@1@^|0|^@2@^|UnCheckValue|^@1@^||^@2@^|UnCheckForeColor|^@1@^|rgba(0,0,0,1)|^@2@^|UnCheckBackColor|^@1@^|rgba(255,255,255,0)|^@2@^|UnCheckLineWidth|^@1@^|1|^@2@^|TextFont|^@1@^|12px 돋움체|^@2@^|TextColor|^@1@^|rgba(0,0,0,1)|^@2@^|TextAlign|^@1@^|0|^@2@^|TextLineSpacing|^@1@^|0|^@2@^|TextBorder|^@1@^|0|^@2@^|TextMaxLine|^@1@^|0|^@2@^|IsViewOutBound|^@1@^|true|^@2@^|IsViewText|^@1@^|true|^@2@^|IsVisible|^@1@^|true|^@2@^|IsBorderLeft|^@1@^|true|^@2@^|IsBorderRight|^@1@^|true|^@2@^|IsBorderTop|^@1@^|true|^@2@^|IsBorderBottom|^@1@^|true|^@2@^|IsUserSizable|^@1@^|true|^@2@^|ChangeHeightItem|^@1@^||^@2@^|ChangeTopItem|^@1@^||^@2@^|TextFormat|^@1@^||^@2@^|EditOnly|^@1@^|false|^@2@^|ClickLeft|^@1@^||^@2@^|ClickRight|^@1@^||^@2@^|ChangedValue|^@1@^||^@2@^|TabFrom|^@1@^|0|^@2@^|TabTo|^@1@^|0|^@2@^|TabEnterFrom|^@1@^|0|^@2@^|TabEnterTo|^@1@^|0|^@2@^|IsIncomplete|^@1@^|false|^@2@^|IncompleteKey|^@1@^||^@2@^|IsWrap|^@1@^|false|^@2@^|CheckText|^@1@^||^@2@^|UnCheckText|^@1@^||^@2@^|Text|^@1@^|d|^@^|d|^@^|asdf|^@^|sadf|^@^|퇴행성관절염 Grade II단계|^@^|방사선상 그대로 유지됨..|^@^|증상지속시 사진 다시 체크|^@^||^@^||^@^||^@^||^@^|sdaf|^@^|sadf|^@^|asdf|^@^|as|^@^|sdaf|^@^|sadf|^@^|asdf|^@^|as|^@^|sdaf|^@^|sadf|^@^|asdf|^@^|as|^@^|sdaf|^@^|sadf|^@^|asdf|^@^|as|^@^|sdaf|^@^|sadf|^@^|asdf|^@^|as|^@^|sdaf|^@^|sadf|^@^|asdf|^@^|as|^@^|sdaf|^@^|sadf|^@^|asdf|^@^|as|^@^|sdaf|^@^|sadf|^@^|asdf|^@^|as|^@^|sdaf|^@^|sadf|^@^|asdf|^@^|as|^@^|sdaf|^@^|sadf|^@^|asdf|^@^|as";
$(document).on("click",".View",function(e){$(".View").removeClass("View_selected"),$(this).addClass("View_selected")});
$(document).on("keydown",function(e){46==e.keyCode&&$(".cursorDiv").length&&(selectedLastElement.remove(),clearCursor())});
function clearCursor(){$(".cursorDiv").remove()}
function clearMouseSelect(){selectedElement=null,selectedElementInit={}}
function clearText(){$(".text").focusout(),$(".text").css("z-index",0)}
function createCursor(e){$(".cursorDiv").remove();var t=$("<div />",{"class":"cursorDiv"});e.before(t),t.css("width",selectedElementInit.width),t.css("height",selectedElementInit.height),t.css("left",selectedElementInit.left),t.css("top",selectedElementInit.top);var s=$("<div />",{"class":"cursorDivRelative"});t.append(s),s.append($("<span />",{style:"left:-3px; top:-3px;"})),s.append($("<span />",{style:"right:-3px; top:-3px;"})),s.append($("<span />",{style:"left:-3px; bottom:-3px;"})),s.append($("<span />",{style:"right:-3px; bottom:-3px;"}))}
function Board(t){this.element=t,this.views=[],this.width=726,this.height=null,this.sort="ASC",this.createElement(t)}Board.prototype.createElement=function(t){var e=$("<div />",{"class":"Board",width:this.width+"px"});e.append($("<input />",{type:"hidden",name:"sort",value:this.sort})),$(t).append(e)},Board.prototype.setSort=function(t){this.sort=t,$(this.element).find("input[name=sort]").val(this.sort)};
function Item(e){this["super"]=e,this.element=null,this.property=["PageKey","PanelKey","ParentItemKey","Key","DataKey","Style","Edit","IsSelectable","IsPrintable","X","Y","Width","Height","Angle","BackColor","BackImageString","BorderColor","BorderWidth","BorderDash","InLineStyle","InLineColor","InLineDash","InLineWidth","InLineCap","Checked","CheckGroup","CheckBoxStyle","CheckBoxAlign","CheckBoxColor","CheckBoxWidth","CheckBoxHeight","CheckBoxLineWidth","CheckStyle","CheckValue","CheckForeColor","CheckBackColor","CheckLineWidth","UnCheckStyle","UnCheckValue","UnCheckForeColor","UnCheckBackColor","UnCheckLineWidth","TextFont","TextColor","TextAlign","TextLineSpacing","TextBorder","TextMaxLine","IsViewOutBound","IsViewText","IsVisible","IsBorderLeft","IsBorderRight","IsBorderTop","IsBorderBottom","IsUserSizable","ChangeHeightItem","ChangeTopItem","TextFormat","EditOnly","ClickLeft","ClickRight","ChangedValue","TabFrom","TabTo","TabEnterFrom","TabEnterTo","IsIncomplete","IncompleteKey","IsWrap","CheckText","UnCheckText","Text"],this.PageKey=null,this.PanelKey=null,this.ParentItemKey=null,this.Key=null,this.DataKey=null,this.Style=null,this.Edit=null,this.IsSelectable=null,this.IsPrintable=null,this.X=null,this.Y=null,this.Width=null,this.Height=null,this.Angle=null,this.BackColor=null,this.BackImageString=null,this.BorderColor=null,this.BorderWidth=null,this.BorderDash=null,this.InLineStyle=null,this.InLineColor=null,this.InLineDash=null,this.InLineWidth=null,this.InLineCap=null,this.Checked=null,this.CheckGroup=null,this.CheckBoxStyle=null,this.CheckBoxAlign=null,this.CheckBoxColor=null,this.CheckBoxWidth=null,this.CheckBoxHeight=null,this.CheckBoxLineWidth=null,this.CheckStyle=null,this.CheckValue=null,this.CheckForeColor=null,this.CheckBackColor=null,this.CheckLineWidth=null,this.UnCheckStyle=null,this.UnCheckValue=null,this.UnCheckForeColor=null,this.UnCheckBackColor=null,this.UnCheckLineWidth=null,this.TextFont=null,this.TextColor=null,this.TextAlign=null,this.TextLineSpacing=null,this.TextBorder=null,this.TextMaxLine=null,this.IsViewOutBound=null,this.IsViewText=null,this.IsVisible=null,this.IsBorderLeft=null,this.IsBorderRight=null,this.IsBorderTop=null,this.IsBorderBottom=null,this.IsUserSizable=null,this.ChangeHeightItem=null,this.ChangeTopItem=null,this.TextFormat=null,this.EditOnly=null,this.ClickLeft=null,this.ClickRight=null,this.ChangedValue=null,this.TabFrom=null,this.TabTo=null,this.TabEnterFrom=null,this.TabEnterTo=null,this.IsIncomplete=null,this.IncompleteKey=null,this.IsWrap=null,this.CheckText=null,this.UnCheckText=null,this.Text=null,this.PropertyTextAlign=["LeftTop","LeftMiddle","LeftBottom","CenterTop","CenterMiddle","CenterBottom","RightTop","RightMiddle","RightBottom"],this.createElement()}Item.prototype.createElement=function(){var e=$("<div />",{"class":"Item",contenteditable:"true"});this.element=e,$(this["super"].element).find(".ItemContainer").prepend(e)},Item.prototype.createPropertyElement=function(){this.element.css("width",this.Width+"px"),this.element.css("height",this.Height+"px"),this.element.css("top",this.Y+"px"),this.element.css("left",this.X+"px"),"1"==this.Style&&this.element.addClass("text"),this.TextFont&&this.element.css("font-size",this.TextFont.split(" ")[0]),this.TextFont&&this.element.css("font-family",this.TextFont.split(" ")[1]),this.TextColor&&this.element.css("color",this.TextColor);var e=this.PropertyTextAlign[this.TextAlign].toLowerCase();for(this.element.css("text-align",e.replace(/top|middle|bottom/,"")),this.element.css("vertical-align",e.replace(/left|center|right/,"")),this.element.css("line-height",this.TextCTextLineSpacingolor||"14px");this.Text.indexOf("|^@^|")>-1;)this.Text=this.Text.replace("|^@^|","<br />");this.element.html(this.Text);for(var t=0;t<this.property.length;t++)this.element.append($("<input />",{type:"hidden",name:this.property[t],value:this[this.property[t]]}))};
function Page(e){this["super"]=e,this.element=null,this.elementTitle=null,this.panels=[],this.property=["Key","Title","Style","Date","Time","IsPrintable","HeadPrint","FootPrint","SheetKey","Value"],this.Key=null,this.Title=null,this.Style=null,this.Date=null,this.Time=null,this.IsPrintable=null,this.HeadPrint=null,this.FootPrint=null,this.SheetKey=null,this.Value=null,this.init(),this.createElement()}Page.prototype.init=function(){var e=new Date,t=e.getMonth()+1,i=e.getDate(),l=e.getFullYear();this.Date=l+"-"+prependZero(t,2)+"-"+prependZero(i,2);var n=e.getHours(),s=e.getMinutes(),r=e.getSeconds();this.Time=n+":"+prependZero(s,2)+":"+prependZero(r,2)},Page.prototype.createElement=function(){var e=$("<div />",{"class":"Page_Title"});this.elementTitle=e,$(this["super"].element).append(e);var t=$("<div />",{"class":"Page"});this.element=t,$(this["super"].element).append(t)},Page.prototype.createPropertyElement=function(){for(var e=0;e<this.property.length;e++)this.element.append($("<input />",{type:"hidden",name:this.property[e],value:this[this.property[e]]}));this.elementTitle.html(this.Date+" "+this.Time+" "+this.Title)};
function Panel(e){this["super"]=e,this.element=null,this.items=[],this.property=["PageKey","Key","BackColor","Width","Height","IsPrintable","ExpandTitle","IsExpandable","IsExpanded","ExPageKey","IsPrintExpand","BackImageString","BackImageWidth","RunPageAdd","RunPageLoad","RunPageSave","IsUserSizable","UserMinHeight","UserMaxHeight","Value","BackImageAngle"],this.PageKey=null,this.Key=null,this.BackColor=null,this.Width=null,this.Height=null,this.IsPrintable=null,this.ExpandTitle=null,this.IsExpandable=null,this.IsExpanded=null,this.ExPageKey=null,this.IsPrintExpand=null,this.BackImageString=null,this.BackImageWidth=null,this.RunPageAdd=null,this.RunPageLoad=null,this.RunPageSave=null,this.IsUserSizable=null,this.UserMinHeight=null,this.UserMaxHeight=null,this.Value=null,this.BackImageAngle=null,this.createElement()}Panel.prototype.createElement=function(){var e=$("<div />",{"class":"Panel"});this.element=e,$(this["super"].element).append(e)},Panel.prototype.createPropertyElement=function(){this.element.css("width",this.Width+"px"),this.element.css("height",this.Height+"px");for(var e=0;e<this.property.length;e++)this.element.append($("<input />",{type:"hidden",name:this.property[e],value:this[this.property[e]]}));this.element.append($("<div />",{"class":"ItemContainer"})),this.element.append($("<canvas />",{"class":"eventCanvas",width:this.Width,height:this.Height}))};
function View(){this.element=null,this.pages=[],this.createElement()}View.prototype.createElement=function(){var e=$("<div />",{"class":"View"});this.element=e,$(".View").removeClass("View_selected"),e.addClass("View_selected"),$(".Board").prepend(e)};
function mousePointToCanvas(t){var e=t.pageX-$(t.target).offset().left,a=t.pageY-$(t.target).offset().top;return{x:e,y:a}}
function prependZero(n,r){for(;n.toString().length<r;)n="0"+n;return n}
$(document).on("mousedown",".eventCanvas",function(t){ItemEditMode==e_ItemEditMode_Cursor&&console.log("test")}),$(document).on("mousemove",".eventCanvas",function(t){if(ItemEditMode==e_ItemEditMode_Cursor){var r=mousePointToCanvas(t),e=r.x-mouseDownInit.x,s=r.y-mouseDownInit.y;"leftTop"==mouseCursorStyle&&(e<0?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e))):$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+objectCursorInit.width-6),$(t.target).parent().find(".cursorDiv").css("width",6)),s<0?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s))):$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+objectCursorInit.height-6),$(t.target).parent().find(".cursorDiv").css("height",6))),"leftCenter"==mouseCursorStyle&&(e<0?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e))):$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+objectCursorInit.width-6),$(t.target).parent().find(".cursorDiv").css("width",6))),"leftBottom"==mouseCursorStyle&&(e<0?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e))):$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+objectCursorInit.width-6),$(t.target).parent().find(".cursorDiv").css("width",6)),s<0?$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",6)):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s)))),"middleTop"==mouseCursorStyle&&(s<0?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s))):$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+objectCursorInit.height-6),$(t.target).parent().find(".cursorDiv").css("height",6))),"rightTop"==mouseCursorStyle&&(e<0?$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",6)):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e))),s<0?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s))):$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+objectCursorInit.height-6),$(t.target).parent().find(".cursorDiv").css("height",6))),"rightCenter"==mouseCursorStyle&&(e<0?$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",6)):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e)))),"rightBottom"==mouseCursorStyle&&(e<0?$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",6)):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e))),s<0?$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",6)):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s)))),"middleBottom"==mouseCursorStyle&&(s<0?$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",6)):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s))))}}),$(document).on("mouseup",".eventCanvas",function(t){ItemEditMode==e_ItemEditMode_Cursor&&(selectedLastElement.css("width",$(t.target).parent().find(".cursorDiv").css("width")),selectedLastElement.css("height",$(t.target).parent().find(".cursorDiv").css("height")),selectedLastElement.css("left",$(t.target).parent().find(".cursorDiv").css("left")),selectedLastElement.css("top",$(t.target).parent().find(".cursorDiv").css("top")),ItemEditMode=e_ItemEditMode_None,mouseCursorStyle=null)}),$(document).on("mouseout",".eventCanvas",function(t){ItemEditMode==e_ItemEditMode_Cursor&&(selectedLastElement.css("width",$(t.target).parent().find(".cursorDiv").css("width")),selectedLastElement.css("height",$(t.target).parent().find(".cursorDiv").css("height")),selectedLastElement.css("left",$(t.target).parent().find(".cursorDiv").css("left")),selectedLastElement.css("top",$(t.target).parent().find(".cursorDiv").css("top")),ItemEditMode=e_ItemEditMode_None,mouseCursorStyle=null)});
$(document).on("mousedown",".eventCanvas",function(e){if($(e.target).parent().find(".cursorDiv").length){var t=mouseDownInit=mousePointToCanvas(e),s=objectCursorInit.width=$(e.target).parent().find(".cursorDiv").width(),o=objectCursorInit.height=$(e.target).parent().find(".cursorDiv").height(),i=objectCursorInit.left=$(e.target).parent().find(".cursorDiv").position().left,n=objectCursorInit.top=$(e.target).parent().find(".cursorDiv").position().top;t.y>n-3&&t.y<n+o+3&&t.x>i-3&&t.x<i+s+3?(t.y>n-3&&t.y<n+3&&t.x>i-3&&t.x<i+3&&(mouseCursorStyle="leftTop",ItemEditMode=e_ItemEditMode_Cursor),t.y>n+o-3&&t.y<n+o+3&&t.x>i-3&&t.x<i+3&&(mouseCursorStyle="leftBottom",ItemEditMode=e_ItemEditMode_Cursor),t.y>n+3&&t.y<n+o-3&&t.x>i-3&&t.x<i+3&&(mouseCursorStyle="leftCenter",ItemEditMode=e_ItemEditMode_Cursor),t.y>n-3&&t.y<n+3&&t.x>i+3&&t.x<i+s-3&&(mouseCursorStyle="middleTop",ItemEditMode=e_ItemEditMode_Cursor),t.y>n-3&&t.y<n+3&&t.x>i+s-3&&t.x<i+s+3&&(mouseCursorStyle="rightTop",ItemEditMode=e_ItemEditMode_Cursor),t.y>n+o-3&&t.y<n+o+3&&t.x>i+s-3&&t.x<i+s+3&&(mouseCursorStyle="rightBottom",ItemEditMode=e_ItemEditMode_Cursor),t.y>n+3&&t.y<n+o-3&&t.x>i+s-3&&t.x<i+s+3&&(mouseCursorStyle="rightCenter",ItemEditMode=e_ItemEditMode_Cursor),t.y>n+o-3&&t.y<n+o+3&&t.x>i+3&&t.x<i+s-3&&(mouseCursorStyle="middleBottom",ItemEditMode=e_ItemEditMode_Cursor)):mouseCursorStyle=null}if(ItemEditMode!=e_ItemEditMode_Cursor&&(clearCursor(),clearText()),ItemEditMode==e_ItemEditMode_None){var t=mouseDownInit=mousePointToCanvas(e);$($(this).parent().find(".Item").get().reverse()).each(function(){null==selectedElement&&t.y>$(this).position().top&&t.y<$(this).position().top+$(this).height()&&t.x>$(this).position().left&&t.x<$(this).position().left+$(this).width()&&(selectedLastElement=selectedElement=$(this),selectedElementInit.width=$(this).width(),selectedElementInit.height=$(this).height(),selectedElementInit.left=$(this).position().left,selectedElementInit.top=$(this).position().top,$(e.target).parent().find(".ItemContainer").append(selectedElement))}),selectedElement?createCursor($(this)):clearCursor()}}),$(document).on("mousemove",".eventCanvas",function(e){if(ItemEditMode==e_ItemEditMode_None){var t=mousePointToCanvas(e);if(null==selectedElement){if($(e.target).parent().find(".cursorDiv").length){var s=$(e.target).parent().find(".cursorDiv").width(),o=$(e.target).parent().find(".cursorDiv").height(),i=$(e.target).parent().find(".cursorDiv").position().left,n=$(e.target).parent().find(".cursorDiv").position().top;t.y>n-3&&t.y<n+o+3&&t.x>i-3&&t.x<i+s+3?($(".eventCanvas").css("cursor","default"),t.y>n-3&&t.y<n+3&&t.x>i-3&&t.x<i+3&&$(".eventCanvas").css("cursor","nw-resize"),t.y>n+o-3&&t.y<n+o+3&&t.x>i-3&&t.x<i+3&&$(".eventCanvas").css("cursor","sw-resize"),t.y>n+3&&t.y<n+o-3&&t.x>i-3&&t.x<i+3&&$(".eventCanvas").css("cursor","w-resize"),t.y>n-3&&t.y<n+3&&t.x>i+3&&t.x<i+s-3&&$(".eventCanvas").css("cursor","n-resize"),t.y>n-3&&t.y<n+3&&t.x>i+s-3&&t.x<i+s+3&&$(".eventCanvas").css("cursor","ne-resize"),t.y>n+o-3&&t.y<n+o+3&&t.x>i+s-3&&t.x<i+s+3&&$(".eventCanvas").css("cursor","se-resize"),t.y>n+3&&t.y<n+o-3&&t.x>i+s-3&&t.x<i+s+3&&$(".eventCanvas").css("cursor","e-resize"),t.y>n+o-3&&t.y<n+o+3&&t.x>i+3&&t.x<i+s-3&&$(".eventCanvas").css("cursor","s-resize")):$(".eventCanvas").css("cursor","default")}}else{var r=t.x-mouseDownInit.x+selectedElementInit.left,d=t.y-mouseDownInit.y+selectedElementInit.top;$(".cursorDiv").css("left",r),$(".cursorDiv").css("top",d)}}}),$(document).on("mouseup",".eventCanvas",function(e){ItemEditMode==e_ItemEditMode_None&&(selectedElement&&(selectedElement.css("left",$(".cursorDiv").css("left")),selectedElement.css("top",$(".cursorDiv").css("top"))),clearMouseSelect())}),$(document).on("mouseout",".eventCanvas",function(e){ItemEditMode==e_ItemEditMode_None&&(selectedElement&&(selectedElement.css("left",$(".cursorDiv").css("left")),selectedElement.css("top",$(".cursorDiv").css("top"))),clearMouseSelect())}),$(document).on("dblclick",".eventCanvas",function(e){if(ItemEditMode==e_ItemEditMode_None){var t=mousePointToCanvas(e);$($(this).parent().find(".Item").get().reverse()).each(function(){null==selectedElement&&t.y>$(this).position().top&&t.y<$(this).position().top+$(this).height()&&t.x>$(this).position().left&&t.x<$(this).position().left+$(this).width()&&(selectedElement=$(this))}),selectedElement&&selectedElement.hasClass("text")&&(selectedElement.focus(),selectedElement.css("z-index",999999)),selectedElement=null}});
var selectedElement=null,selectedLastElement=null,selectedElementInit={},mouseCursorStyle=null,objectCursorInit={},mouseDownInit={},e_ItemEditMode_None=0,e_ItemEditMode_Cursor=1,ItemEditMode=e_ItemEditMode_None;