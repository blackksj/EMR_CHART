var board=null,views=[];$(function(){board=new Board(document.querySelector("#contentWrap")),board.setSort("DESC"),$("#font_family").on("change",function(){document.execCommand("FontName",!1,$(this).val()),$(selectedLastElement).find("font").each(function(){"돋움"==$(this).attr("face")&&$(this).css("font-family","돋움"),"돋움체"==$(this).attr("face")&&$(this).css("font-family","돋움체"),"굴림"==$(this).attr("face")&&$(this).css("font-family","굴림"),"굴림체"==$(this).attr("face")&&$(this).css("font-family","굴림체"),"바탕체"==$(this).attr("face")&&$(this).css("font-family","바탕체"),$(this).removeAttr("face")})}),$("#font_size").on("change",function(){document.execCommand("fontSize",!1,$(this).val()),$(selectedLastElement).find("font").each(function(){1==$(this).attr("size")&&($(this).css("font-size","10px"),$(this).css("line-height","10px")),2==$(this).attr("size")&&($(this).css("font-size","12px"),$(this).css("line-height","12px")),3==$(this).attr("size")&&($(this).css("font-size","14px"),$(this).css("line-height","14px")),4==$(this).attr("size")&&($(this).css("font-size","16px"),$(this).css("line-height","16px")),5==$(this).attr("size")&&($(this).css("font-size","20px"),$(this).css("line-height","20px")),6==$(this).attr("size")&&($(this).css("font-size","30px"),$(this).css("line-height","30px")),7==$(this).attr("size")&&($(this).css("font-size","40px"),$(this).css("line-height","40px")),$(this).removeAttr("size")}),textHeightChange()}),$("#font_color").on("change",function(){document.execCommand("foreColor",!1,$(this).val()),$(selectedLastElement).find("font").each(function(){$(this).css("color",$(this).attr("color")),$(this).removeAttr("color")})}),$("#font_bold").on("click",function(){document.execCommand("bold",!1,!0)}),$("#font_underline").on("click",function(){document.execCommand("underline",!1,!0)}),$("#font_italic").on("click",function(){document.execCommand("italic",!1,!0)}),$("#font_text").on("click",function(){clearText(),clearCursor(),ItemEditMode=e_ItemEditMode_Text}),$("#image_load").on("change",function(){console.log($(this).files)})});
function DataLoad(E){for(var e=E.split("|^@4@^|"),t=new View,a=new Page(t),A=null,P=null,r=0;r<e.length;r++){var l=e[r].split("|^@3@^|");switch(l[0]){case"PAGE_NAMEVALUE":for(var n=l[1].split("|^@2@^|"),_=0;_<n.length;_++){var s=n[_].split("|^@1@^|");s[1]&&(a[s[0]]=s[1])}a.createPropertyElement();break;case"PANEL_NAMEVALUE":A=new Panel(a);for(var n=l[1].split("|^@2@^|"),_=0;_<n.length;_++){var s=n[_].split("|^@1@^|");s[1]&&(A[s[0]]=s[1])}A.createElement(),A.createPropertyElement(),a.panels.push(A);break;case"ITEM_NAMEVALUE":P=new Item(A);for(var n=l[1].split("|^@2@^|"),_=0;_<n.length;_++){var s=n[_].split("|^@1@^|");s[1]&&(P[s[0]]=s[1])}P.createElement(),P.createPropertyElement(),A.items.push(P)}}t.pages.push(a),views.push(t)}$(function(){GetCommandArgs("PAGE_KEY|^@^|00001|^@@^|PAGE_TITLE|^@^|00002|^@@^|PAGE_LOCKED|^@^|0","PAGE_KEY,PAGE_TITLE,PAGE_DATE,PAGE_TIME,PAGE_KIND,PAGE_LOCKED,PAGE_LOCKEDNAME,PAGE_SIGN,VIEW_KIND,PAGE_SELECT,PAGE_MODIFIED,REG_NAME,PAGE_INOUT,PAGE_DEPT,PAGE_PRINT,PAGE_PRINTNAME");DataLoad(data)});
function GetCommandArgs(r,e){var t=e.toUpperCase().split(","),a=new Array;if(r&&r.length>0){for(var n=r.split("|^@@^|"),l=0;l<n.length;l++){var o=n[l].split("|^@^|");a[o[0].toUpperCase()]=o[1]}for(var l=0;l<t.length;l++)t[l]=a[t[l]],t[l]||(t[l]="")}else for(var l=0;l<t.length;l++)t[l]="";return t}
var data="PAGE_NAMEVALUE|^@3@^|Key|^@1@^|3|^@2@^|Title|^@1@^|3번페이지|^@2@^|Style|^@1@^|0|^@2@^|Date|^@1@^|2016-09-20|^@2@^|Time|^@1@^|14:42:18|^@2@^|IsPrintable|^@1@^|true|^@2@^|HeadPrint|^@1@^|A|^@2@^|FootPrint|^@1@^|A|^@2@^|SheetKey|^@1@^|1|^@2@^|Value|^@1@^||^@4@^|PANEL_NAMEVALUE|^@3@^|PageKey|^@1@^|3|^@2@^|Key|^@1@^|1|^@2@^|BackColor|^@1@^|rgba(255,255,255,1)|^@2@^|Width|^@1@^|720|^@2@^|Height|^@1@^|300|^@2@^|IsPrintable|^@1@^|true|^@2@^|ExpandTitle|^@1@^||^@2@^|IsExpandable|^@1@^|false|^@2@^|IsExpanded|^@1@^|true|^@2@^|ExPageKey|^@1@^||^@2@^|IsPrintExpand|^@1@^|false|^@2@^|BackImageString|^@1@^||^@2@^|BackImageWidth|^@1@^|720|^@2@^|RunPageAdd|^@1@^||^@2@^|RunPageLoad|^@1@^||^@2@^|RunPageSave|^@1@^||^@2@^|IsUserSizable|^@1@^|false|^@2@^|UserMinHeight|^@1@^|300|^@2@^|UserMaxHeight|^@1@^|1000|^@2@^|Value|^@1@^||^@2@^|BackImageAngle|^@1@^|0|^@4@^|ITEM_NAMEVALUE|^@3@^|PageKey|^@1@^|3|^@2@^|PanelKey|^@1@^|1|^@2@^|ParentItemKey|^@1@^|-1|^@2@^|Key|^@1@^|1|^@2@^|DataKey|^@1@^||^@2@^|Style|^@1@^|1|^@2@^|Edit|^@1@^|true|^@2@^|IsSelectable|^@1@^|false|^@2@^|IsPrintable|^@1@^|true|^@2@^|X|^@1@^|108|^@2@^|Y|^@1@^|36|^@2@^|Width|^@1@^|100|^@2@^|Height|^@1@^|25|^@2@^|Angle|^@1@^|0|^@2@^|BackColor|^@1@^|rgba(255,255,255,0)|^@2@^|BackImageString|^@1@^||^@2@^|BorderColor|^@1@^|rgba(0,0,0,1)|^@2@^|BorderWidth|^@1@^|0|^@2@^|BorderDash|^@1@^||^@2@^|InLineStyle|^@1@^|0|^@2@^|InLineColor|^@1@^|rgba(0,0,0,1)|^@2@^|InLineDash|^@1@^||^@2@^|InLineWidth|^@1@^|1|^@2@^|InLineCap|^@1@^|butt|^@2@^|Checked|^@1@^|false|^@2@^|CheckGroup|^@1@^||^@2@^|CheckBoxStyle|^@1@^|1|^@2@^|CheckBoxAlign|^@1@^|1|^@2@^|CheckBoxColor|^@1@^|rgba(0,0,0,1)|^@2@^|CheckBoxWidth|^@1@^|12|^@2@^|CheckBoxHeight|^@1@^|12|^@2@^|CheckBoxLineWidth|^@1@^|1|^@2@^|CheckStyle|^@1@^|1|^@2@^|CheckValue|^@1@^||^@2@^|CheckForeColor|^@1@^|rgba(0,0,0,1)|^@2@^|CheckBackColor|^@1@^|rgba(255,255,255,0)|^@2@^|CheckLineWidth|^@1@^|2|^@2@^|UnCheckStyle|^@1@^|0|^@2@^|UnCheckValue|^@1@^||^@2@^|UnCheckForeColor|^@1@^|rgba(0,0,0,1)|^@2@^|UnCheckBackColor|^@1@^|rgba(255,255,255,0)|^@2@^|UnCheckLineWidth|^@1@^|1|^@2@^|TextFont|^@1@^|12px 돋움체|^@2@^|TextColor|^@1@^|rgba(0,0,0,1)|^@2@^|TextAlign|^@1@^|1|^@2@^|TextLineSpacing|^@1@^|0|^@2@^|TextBorder|^@1@^|0|^@2@^|TextMaxLine|^@1@^|0|^@2@^|IsViewOutBound|^@1@^|false|^@2@^|IsViewText|^@1@^|true|^@2@^|IsVisible|^@1@^|true|^@2@^|IsBorderLeft|^@1@^|true|^@2@^|IsBorderRight|^@1@^|true|^@2@^|IsBorderTop|^@1@^|true|^@2@^|IsBorderBottom|^@1@^|true|^@2@^|IsUserSizable|^@1@^|false|^@2@^|ChangeHeightItem|^@1@^||^@2@^|ChangeTopItem|^@1@^||^@2@^|TextFormat|^@1@^||^@2@^|EditOnly|^@1@^|false|^@2@^|ClickLeft|^@1@^||^@2@^|ClickRight|^@1@^||^@2@^|ChangedValue|^@1@^||^@2@^|TabFrom|^@1@^|0|^@2@^|TabTo|^@1@^|0|^@2@^|TabEnterFrom|^@1@^|0|^@2@^|TabEnterTo|^@1@^|0|^@2@^|IsIncomplete|^@1@^|false|^@2@^|IncompleteKey|^@1@^||^@2@^|IsWrap|^@1@^|false|^@2@^|CheckText|^@1@^||^@2@^|UnCheckText|^@1@^||^@2@^|Text|^@1@^|테스트|^@4@^|ITEM_NAMEVALUE|^@3@^|PageKey|^@1@^|3|^@2@^|PanelKey|^@1@^|1|^@2@^|ParentItemKey|^@1@^|-1|^@2@^|Key|^@1@^|2|^@2@^|DataKey|^@1@^||^@2@^|Style|^@1@^|1|^@2@^|Edit|^@1@^|true|^@2@^|IsSelectable|^@1@^|true|^@2@^|IsPrintable|^@1@^|true|^@2@^|X|^@1@^|317|^@2@^|Y|^@1@^|34|^@2@^|Width|^@1@^|306|^@2@^|Height|^@1@^|163|^@2@^|Angle|^@1@^|0|^@2@^|BackColor|^@1@^|rgba(255,255,255,0)|^@2@^|BackImageString|^@1@^||^@2@^|BorderColor|^@1@^|rgba(0,0,0,1)|^@2@^|BorderWidth|^@1@^|0|^@2@^|BorderDash|^@1@^||^@2@^|InLineStyle|^@1@^|0|^@2@^|InLineColor|^@1@^|rgba(0,0,0,1)|^@2@^|InLineDash|^@1@^||^@2@^|InLineWidth|^@1@^|1|^@2@^|InLineCap|^@1@^|butt|^@2@^|Checked|^@1@^|false|^@2@^|CheckGroup|^@1@^||^@2@^|CheckBoxStyle|^@1@^|1|^@2@^|CheckBoxAlign|^@1@^|1|^@2@^|CheckBoxColor|^@1@^|rgba(0,0,0,1)|^@2@^|CheckBoxWidth|^@1@^|12|^@2@^|CheckBoxHeight|^@1@^|12|^@2@^|CheckBoxLineWidth|^@1@^|1|^@2@^|CheckStyle|^@1@^|1|^@2@^|CheckValue|^@1@^||^@2@^|CheckForeColor|^@1@^|rgba(0,0,0,1)|^@2@^|CheckBackColor|^@1@^|rgba(255,255,255,0)|^@2@^|CheckLineWidth|^@1@^|2|^@2@^|UnCheckStyle|^@1@^|0|^@2@^|UnCheckValue|^@1@^||^@2@^|UnCheckForeColor|^@1@^|rgba(0,0,0,1)|^@2@^|UnCheckBackColor|^@1@^|rgba(255,255,255,0)|^@2@^|UnCheckLineWidth|^@1@^|1|^@2@^|TextFont|^@1@^|bold 30px 궁서|^@2@^|TextColor|^@1@^|rgba(255,0,0,1)|^@2@^|TextAlign|^@1@^|0|^@2@^|TextLineSpacing|^@1@^|0|^@2@^|TextBorder|^@1@^|0|^@2@^|TextMaxLine|^@1@^|0|^@2@^|IsViewOutBound|^@1@^|false|^@2@^|IsViewText|^@1@^|true|^@2@^|IsVisible|^@1@^|true|^@2@^|IsBorderLeft|^@1@^|true|^@2@^|IsBorderRight|^@1@^|true|^@2@^|IsBorderTop|^@1@^|true|^@2@^|IsBorderBottom|^@1@^|true|^@2@^|IsUserSizable|^@1@^|false|^@2@^|ChangeHeightItem|^@1@^||^@2@^|ChangeTopItem|^@1@^||^@2@^|TextFormat|^@1@^||^@2@^|EditOnly|^@1@^|false|^@2@^|ClickLeft|^@1@^||^@2@^|ClickRight|^@1@^||^@2@^|ChangedValue|^@1@^||^@2@^|TabFrom|^@1@^|0|^@2@^|TabTo|^@1@^|0|^@2@^|TabEnterFrom|^@1@^|0|^@2@^|TabEnterTo|^@1@^|0|^@2@^|IsIncomplete|^@1@^|false|^@2@^|IncompleteKey|^@1@^||^@2@^|IsWrap|^@1@^|false|^@2@^|CheckText|^@1@^||^@2@^|UnCheckText|^@1@^||^@2@^|Text|^@1@^|ddddddddddd|^@^|dddddddsafas|^@^|fsdafsdaf";
$(document).on("contextmenu",".eventCanvas",function(e){e.preventDefault(),selectedContextElement=null;var t=mousePointToCanvas(e);$($(this).parent().find(".Item").get().reverse()).each(function(){if(null==selectedContextElement&&t.y>$(this).position().top&&t.y<$(this).position().top+$(this).height()&&t.x>$(this).position().left&&t.x<$(this).position().left+$(this).width()&&(selectedContextElement=$(this),selectedContextElement.find("input[name=ClickRight]").val())){var e=selectedContextElement.find("input[name=ClickRight]").val(),n=e.split("|^@@^|"),i=n[1].split("|^@^|");if("LIST"==i[0]){for(var l="<ul class='rightClickContextMenu' style='left:"+(event.pageX-5)+"px; top:"+(event.pageY-5)+"px;'>",o=1;o<i.length;o++)i[o]&&(l+="<li>"+i[o]+"</li>");l+="</ul>",$("body").append(l)}}})}),$(document).on("mouseenter",".rightClickContextMenu li",function(){$(this).addClass("active")}),$(document).on("mouseleave",".rightClickContextMenu li",function(){$(this).removeClass("active")}),$(document).on("click",".rightClickContextMenu li",function(){if(selectedContextElement.find(".selectBox").remove(),!selectedContextElement.find(".selectBox").length){var e=$("<span />",{"class":"selectBox"});e.html($(this).text()),selectedContextElement.append(e)}selectedContextElement.find("input[name=Text]").val($(this).text()),$(this).parent().remove()}),$(document).on("mouseleave",".rightClickContextMenu",function(){$(this).remove()});
$(document).on("contextmenu",".Page_Title",function(e){e.preventDefault();var n=$("<ul />",{"class":"rightClickContextMenu",style:"left:"+(event.pageX-5)+"px; top:"+(event.pageY-5)+"px;"});n.append("<li>페이지 복사(오늘)</li>"),n.append("<li>일자변경</li>"),n.append("<li>시간변경</li>"),$("body").append(n)});
$(document).on("click",".View",function(e){$(".View").removeClass("View_selected"),$(this).addClass("View_selected")});
$(document).on("keydown",function(e){46==e.keyCode||8==e.keyCode,46==e.keyCode&&focusElement}),$(document).on("keyup",function(e){if((46==e.keyCode||8==e.keyCode)&&0==focusElement.find("input[type=hidden]").length)for(var n=0;n<tempFucusElementChildElement.length;n++)focusElement.prepend(tempFucusElementChildElement[n])});
$(document).on("keyup",function(e){27==e.keyCode&&(clearCursor(),clearText(),$(".text").focusout())});
$(document).on("keyup",function(e){textHeightChange()});
function Board(t){this.element=t,this.views=[],this.width=726,this.height=null,this.sort="ASC",this.createElement(t)}Board.prototype.createElement=function(t){var e=$("<div />",{"class":"Board",width:this.width+"px"});e.append($("<input />",{type:"hidden",name:"sort",value:this.sort})),$(t).append(e)},Board.prototype.setSort=function(t){this.sort=t,$(this.element).find("input[name=sort]").val(this.sort)};
function Item(t){this["super"]=t,this.element=null,this.property=itemProperty,this.PageKey=null,this.PanelKey=null,this.ParentItemKey=null,this.Key=null,this.DataKey=null,this.Style=null,this.Edit=null,this.IsSelectable=null,this.IsPrintable=null,this.X=null,this.Y=null,this.Width=null,this.Height=null,this.Angle=null,this.BackColor=null,this.BackImageString=null,this.BorderColor=null,this.BorderWidth=null,this.BorderDash=null,this.InLineStyle=null,this.InLineColor=null,this.InLineDash=null,this.InLineWidth=null,this.InLineCap=null,this.Checked=null,this.CheckGroup=null,this.CheckBoxStyle=null,this.CheckBoxAlign=null,this.CheckBoxColor=null,this.CheckBoxWidth=null,this.CheckBoxHeight=null,this.CheckBoxLineWidth=null,this.CheckStyle=null,this.CheckValue=null,this.CheckForeColor=null,this.CheckBackColor=null,this.CheckLineWidth=null,this.UnCheckStyle=null,this.UnCheckValue=null,this.UnCheckForeColor=null,this.UnCheckBackColor=null,this.UnCheckLineWidth=null,this.TextFont=null,this.TextColor=null,this.TextAlign=null,this.TextLineSpacing=null,this.TextBorder=null,this.TextMaxLine=null,this.IsViewOutBound=null,this.IsViewText=null,this.IsVisible=null,this.IsBorderLeft=null,this.IsBorderRight=null,this.IsBorderTop=null,this.IsBorderBottom=null,this.IsUserSizable=null,this.ChangeHeightItem=null,this.ChangeTopItem=null,this.TextFormat=null,this.EditOnly=null,this.ClickLeft=null,this.ClickRight=null,this.ChangedValue=null,this.TabFrom=null,this.TabTo=null,this.TabEnterFrom=null,this.TabEnterTo=null,this.IsIncomplete=null,this.IncompleteKey=null,this.IsWrap=null,this.CheckText=null,this.UnCheckText=null,this.Text=null,this.PropertyTextAlign=["LeftTop","LeftMiddle","LeftBottom","CenterTop","CenterMiddle","CenterBottom","RightTop","RightMiddle","RightBottom"]}Item.prototype.createElement=function(){if(this.BackImageString){var t=$("<img />",{"class":"Item",src:this.BackImageString});this.element=t}else{var t=$("<div />",{"class":"Item"});this.element=t}$(this["super"].element).find(".ItemContainer").prepend(t)},Item.prototype.createPropertyElement=function(){this.element.addClass("ItemKey_"+this.Key),"1"!=this.Style||this.BackImageString||this.element.addClass("text"),"2"!=this.Style||this.BackImageString||this.element.addClass("checkbox"),this.BackImageString&&this.element.addClass("image"),this.element.css("width",this.Width-1+"px"),this.element.css("height",this.Height+"px"),this.element.css("top",this.Y+"px"),this.element.css("left",this.X+"px");var t=this.PropertyTextAlign[this.TextAlign].toLowerCase(),e=t.replace(/top|middle|bottom/,""),i=t.replace(/left|center|right/,"");if(this.element.css("text-align",e),this.element.css("vertical-align",i),this.TextFont&&(2==this.TextFont.split(" ").length&&(this.element.css("font-family",this.TextFont.split(" ")[1]),this.element.css("font-size",this.TextFont.split(" ")[0]),this.Text&&0==this.TextLineSpacing&&(this.Text.indexOf("|^@^|")>-1||"middle"==i&&this.element.css("line-height",this.Height+"px"))),3==this.TextFont.split(" ").length&&(this.element.css("font-family",this.TextFont.split(" ")[2]),this.element.css("font-size",this.TextFont.split(" ")[1]),this.element.css("line-height",this.TextFont.split(" ")[1]),this.Text&&0==this.TextLineSpacing&&(this.Text.indexOf("|^@^|")>-1||"middle"==i&&this.element.css("line-height",this.Height+"px")),"bold"==this.TextFont.split(" ")[0]&&this.element.css("font-weight","bold"))),this.TextColor&&this.element.css("color",this.TextColor),this.BackColor&&this.element.css("background-color",this.BackColor),this.IsBorderLeft&&this.element.css("border-left",this.BorderWidth+"px"),this.IsBorderRight&&this.element.css("border-right",this.BorderWidth+"px"),this.IsBorderTop&&this.element.css("border-top",this.BorderWidth+"px"),this.IsBorderBottom&&this.element.css("border-bottom",this.BorderWidth+"px"),this.element.css("border-style","solid"),this.BorderColor&&this.element.css("border-color",this.BorderColor),"1"==this.Style&&"true"==this.Edit&&this.element.attr("contenteditable",!0),"1"==this.Style){if(this.Text)for(;this.Text.indexOf("|^@^|")>-1;)this.Text=this.Text.replace("|^@^|","<br />");this.element.html(this.Text)}"2"==this.Style&&this.element.html("<input type='checkbox' />"+this.Text);for(var l=0;l<this.property.length;l++)this.element.append($("<input />",{type:"hidden",name:this.property[l],value:this[this.property[l]]}))};
function Page(e){this["super"]=e,this.element=null,this.elementTitle=null,this.panels=[],this.property=["Key","Title","Style","Date","Time","IsPrintable","HeadPrint","FootPrint","SheetKey","Value"],this.Key=null,this.Title=null,this.Style=null,this.Date=null,this.Time=null,this.IsPrintable=null,this.HeadPrint=null,this.FootPrint=null,this.SheetKey=null,this.Value=null,this.init(),this.createElement()}Page.prototype.init=function(){var e=new Date,t=e.getMonth()+1,i=e.getDate(),l=e.getFullYear();this.Date=l+"-"+prependZero(t,2)+"-"+prependZero(i,2);var n=e.getHours(),s=e.getMinutes(),r=e.getSeconds();this.Time=n+":"+prependZero(s,2)+":"+prependZero(r,2)},Page.prototype.createElement=function(){var e=$("<div />",{"class":"Page_Title"});this.elementTitle=e,$(this["super"].element).append(e);var t=$("<div />",{"class":"Page"});this.element=t,$(this["super"].element).append(t)},Page.prototype.createPropertyElement=function(){for(var e=0;e<this.property.length;e++)this.element.append($("<input />",{type:"hidden",name:this.property[e],value:this[this.property[e]]}));this.elementTitle.html(this.Date+" "+this.Time+" "+this.Title)};
function Panel(e){this["super"]=e,this.element=null,this.items=[],this.property=["PageKey","Key","BackColor","Width","Height","IsPrintable","ExpandTitle","IsExpandable","IsExpanded","ExPageKey","IsPrintExpand","BackImageString","BackImageWidth","RunPageAdd","RunPageLoad","RunPageSave","IsUserSizable","UserMinHeight","UserMaxHeight","Value","BackImageAngle","Pens"],this.PageKey=null,this.Key=null,this.BackColor=null,this.Width=null,this.Height=null,this.IsPrintable=null,this.ExpandTitle=null,this.IsExpandable=null,this.IsExpanded=null,this.ExPageKey=null,this.IsPrintExpand=null,this.BackImageString=null,this.BackImageWidth=null,this.RunPageAdd=null,this.RunPageLoad=null,this.RunPageSave=null,this.IsUserSizable=null,this.UserMinHeight=null,this.UserMaxHeight=null,this.Value=null,this.BackImageAngle=null,this.Pens=null}Panel.prototype.createElement=function(){var e=$("<div />",{"class":"Panel"});this.element=e,$(this["super"].element).append(e)},Panel.prototype.createPropertyElement=function(){this.element.css("width",this.Width+"px"),this.element.css("height",this.Height+"px");for(var e=0;e<this.property.length;e++)this.element.append($("<input />",{type:"hidden",name:this.property[e],value:this[this.property[e]]}));if(this.BackImageString&&this.element.append($("<img />",{"class":"panelImage",width:this.Width,height:this.Height,src:this.BackImageString})),this.element.append($("<div />",{"class":"ItemContainer"})),this.Pens){var t=$("<canvas />",{"class":"penCanvas",width:this.Width,height:this.Height});t.attr("width",this.Width),t.attr("height",this.Height);var i=t[0].getContext("2d");this.element.append(t);for(var s=this.Pens.split("|^@@^|"),e=0;e<s.length;e++){var n=1;i.beginPath();for(var h=s[e].split("|^@^|"),l=h[1].split(":"),a=0;a<l.length;a++){var r=l[a].split(",");0==a?i.moveTo(r[0],r[1]):i.lineTo(r[0],r[1]),n=r[2]}i.strokeStyle=h[0],i.lineWidth=n,i.lineCap="butt",i.stroke(),i.closePath()}}this.element.append($("<canvas />",{"class":"eventCanvas",width:this.Width,height:this.Height}))};
var itemProperty=["PageKey","PanelKey","ParentItemKey","Key","DataKey","Style","Edit","IsSelectable","IsPrintable","X","Y","Width","Height","Angle","BackColor","BackImageString","BorderColor","BorderWidth","BorderDash","InLineStyle","InLineColor","InLineDash","InLineWidth","InLineCap","Checked","CheckGroup","CheckBoxStyle","CheckBoxAlign","CheckBoxColor","CheckBoxWidth","CheckBoxHeight","CheckBoxLineWidth","CheckStyle","CheckValue","CheckForeColor","CheckBackColor","CheckLineWidth","UnCheckStyle","UnCheckValue","UnCheckForeColor","UnCheckBackColor","UnCheckLineWidth","TextFont","TextColor","TextAlign","TextLineSpacing","TextBorder","TextMaxLine","IsViewOutBound","IsViewText","IsVisible","IsBorderLeft","IsBorderRight","IsBorderTop","IsBorderBottom","IsUserSizable","ChangeHeightItem","ChangeTopItem","TextFormat","EditOnly","ClickLeft","ClickRight","ChangedValue","TabFrom","TabTo","TabEnterFrom","TabEnterTo","IsIncomplete","IncompleteKey","IsWrap","CheckText","UnCheckText","Text"];
function View(){this.element=null,this.pages=[],this.createElement()}View.prototype.createElement=function(){var e=$("<div />",{"class":"View"});this.element=e,$(".View").removeClass("View_selected"),e.addClass("View_selected"),$(".Board").prepend(e)};
function clearCursor(){$(".cursorDiv").remove()}
function clearMouseSelect(){selectedElement=null,selectedElementInit={}}
function clearText(){$(".text").focusout(),$(".text").css("z-index",0),focusElement=null}
function createCursor(e){$(".cursorDiv").remove();var t=$("<div />",{"class":"cursorDiv"});e.before(t),t.css("width",selectedElementInit.width),t.css("height",selectedElementInit.height),t.css("left",selectedElementInit.left),t.css("top",selectedElementInit.top);var s=$("<div />",{"class":"cursorDivRelative"});t.append(s),s.append($("<span />",{style:"left:-3px; top:-3px;"})),s.append($("<span />",{style:"right:-3px; top:-3px;"})),s.append($("<span />",{style:"left:-3px; bottom:-3px;"})),s.append($("<span />",{style:"right:-3px; bottom:-3px;"}))}
function createRect(s){$(".cursorDiv").remove();var e=$("<div />",{"class":"cursorDiv"});s.before(e),e.css("width",0),e.css("height",0),e.css("left",mouseDownInit.x),e.css("top",mouseDownInit.y)}
function textHeightChange(){if(focusElement&&(focusElement.css("height",""),parseFloat(focusElement.find("input[name=Height]").val())<focusElement.height()?focusElement.css("height",focusElement.height()):focusElement.css("height",focusElement.find("input[name=Height]").val()+"px"),focusElement.closest(".Panel").height()<focusElement.height()&&(focusElement.closest(".Panel").css("height",focusElement.height()),focusElement.closest(".Panel").find(".eventCanvas").css("height",focusElement.height())),focusElement.find("input[name=ChangeHeightItem]").val()))for(var e=focusElement.find("input[name=ChangeHeightItem]").val().split(","),t=0;t<e.length;t++)focusElement.closest(".Panel").find(".ItemKey_"+e[t]).css("height",focusElement.height())}
function mousePointToCanvas(t){var e=t.pageX-$(t.target).offset().left,a=t.pageY-$(t.target).offset().top;return{x:e,y:a}}
function prependZero(n,r){for(;n.toString().length<r;)n="0"+n;return n}
$(document).on("mousedown",".eventCanvas",function(t){3==t.which}),$(document).on("mousemove",".eventCanvas",function(t){if(ItemEditMode==e_ItemEditMode_Cursor){var r=mousePointToCanvas(t),e=r.x-mouseDownInit.x,s=r.y-mouseDownInit.y;"leftTop"==mouseCursorStyle&&(e<0?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e))):$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+objectCursorInit.width-6),$(t.target).parent().find(".cursorDiv").css("width",6)),s<0?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s))):$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+objectCursorInit.height-6),$(t.target).parent().find(".cursorDiv").css("height",6))),"leftCenter"==mouseCursorStyle&&(e<0?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e))):$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+objectCursorInit.width-6),$(t.target).parent().find(".cursorDiv").css("width",6))),"leftBottom"==mouseCursorStyle&&(e<0?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e))):$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+e),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left+objectCursorInit.width-6),$(t.target).parent().find(".cursorDiv").css("width",6)),s<0?$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",6)):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s)))),"middleTop"==mouseCursorStyle&&(s<0?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s))):$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+objectCursorInit.height-6),$(t.target).parent().find(".cursorDiv").css("height",6))),"rightTop"==mouseCursorStyle&&(e<0?$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",6)):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e))),s<0?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s))):$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+s),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top+objectCursorInit.height-6),$(t.target).parent().find(".cursorDiv").css("height",6))),"rightCenter"==mouseCursorStyle&&(e<0?$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",6)):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e)))),"rightBottom"==mouseCursorStyle&&(e<0?$(t.target).parent().find(".cursorDiv").width()>6?($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width-Math.abs(e))):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",6)):($(t.target).parent().find(".cursorDiv").css("left",objectCursorInit.left),$(t.target).parent().find(".cursorDiv").css("width",objectCursorInit.width+Math.abs(e))),s<0?$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",6)):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s)))),"middleBottom"==mouseCursorStyle&&(s<0?$(t.target).parent().find(".cursorDiv").height()>6?($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height-Math.abs(s))):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",6)):($(t.target).parent().find(".cursorDiv").css("top",objectCursorInit.top),$(t.target).parent().find(".cursorDiv").css("height",objectCursorInit.height+Math.abs(s))))}}),$(document).on("mouseup",".eventCanvas",function(t){3!=t.which&&ItemEditMode==e_ItemEditMode_Cursor&&(selectedLastElement.css("width",$(t.target).parent().find(".cursorDiv").css("width")),selectedLastElement.css("height",$(t.target).parent().find(".cursorDiv").css("height")),selectedLastElement.css("left",$(t.target).parent().find(".cursorDiv").css("left")),selectedLastElement.css("top",$(t.target).parent().find(".cursorDiv").css("top")),ItemEditMode=e_ItemEditMode_None,mouseCursorStyle=null)}),$(document).on("mouseout",".eventCanvas",function(t){ItemEditMode==e_ItemEditMode_Cursor&&(selectedLastElement.css("width",$(t.target).parent().find(".cursorDiv").css("width")),selectedLastElement.css("height",$(t.target).parent().find(".cursorDiv").css("height")),selectedLastElement.css("left",$(t.target).parent().find(".cursorDiv").css("left")),selectedLastElement.css("top",$(t.target).parent().find(".cursorDiv").css("top")),ItemEditMode=e_ItemEditMode_None,mouseCursorStyle=null)});
$(document).on("mousedown",".eventCanvas",function(e){if(3!=e.which){if($(e.target).parent().find(".cursorDiv").length){var t=mouseDownInit=mousePointToCanvas(e),s=objectCursorInit.width=$(e.target).parent().find(".cursorDiv").width(),o=objectCursorInit.height=$(e.target).parent().find(".cursorDiv").height(),n=objectCursorInit.left=$(e.target).parent().find(".cursorDiv").position().left,i=objectCursorInit.top=$(e.target).parent().find(".cursorDiv").position().top;t.y>i-3&&t.y<i+o+3&&t.x>n-3&&t.x<n+s+3?(t.y>i-3&&t.y<i+3&&t.x>n-3&&t.x<n+3&&(mouseCursorStyle="leftTop",ItemEditMode=e_ItemEditMode_Cursor),t.y>i+o-3&&t.y<i+o+3&&t.x>n-3&&t.x<n+3&&(mouseCursorStyle="leftBottom",ItemEditMode=e_ItemEditMode_Cursor),t.y>i+3&&t.y<i+o-3&&t.x>n-3&&t.x<n+3&&(mouseCursorStyle="leftCenter",ItemEditMode=e_ItemEditMode_Cursor),t.y>i-3&&t.y<i+3&&t.x>n+3&&t.x<n+s-3&&(mouseCursorStyle="middleTop",ItemEditMode=e_ItemEditMode_Cursor),t.y>i-3&&t.y<i+3&&t.x>n+s-3&&t.x<n+s+3&&(mouseCursorStyle="rightTop",ItemEditMode=e_ItemEditMode_Cursor),t.y>i+o-3&&t.y<i+o+3&&t.x>n+s-3&&t.x<n+s+3&&(mouseCursorStyle="rightBottom",ItemEditMode=e_ItemEditMode_Cursor),t.y>i+3&&t.y<i+o-3&&t.x>n+s-3&&t.x<n+s+3&&(mouseCursorStyle="rightCenter",ItemEditMode=e_ItemEditMode_Cursor),t.y>i+o-3&&t.y<i+o+3&&t.x>n+3&&t.x<n+s-3&&(mouseCursorStyle="middleBottom",ItemEditMode=e_ItemEditMode_Cursor)):mouseCursorStyle=null}if(ItemEditMode!=e_ItemEditMode_Cursor&&(clearCursor(),clearText()),ItemEditMode==e_ItemEditMode_None){var t=mouseDownInit=mousePointToCanvas(e);$($(this).parent().find(".Item").get().reverse()).each(function(){null==selectedElement&&t.y>$(this).position().top&&t.y<$(this).position().top+$(this).height()&&t.x>$(this).position().left&&t.x<$(this).position().left+$(this).width()&&("true"==$(this).find("input[name=IsSelectable]").val()?(selectedLastElement=selectedElement=$(this),selectedElementInit.width=$(this).width(),selectedElementInit.height=$(this).height(),selectedElementInit.left=$(this).position().left,selectedElementInit.top=$(this).position().top,$(e.target).parent().find(".ItemContainer").append(selectedElement)):"true"==$(this).attr("contenteditable")&&(focusElement=$(this),tempFucusElementChildElement=[],focusElement.find("input[type=hidden]").each(function(){tempFucusElementChildElement.push($(this))})))}),focusElement&&focusElement.hasClass("text")&&(focusElement.focus(),focusElement.css("z-index",999999)),selectedElement?createCursor($(this)):clearCursor()}}}),$(document).on("mousemove",".eventCanvas",function(e){if(ItemEditMode==e_ItemEditMode_None){var t=mousePointToCanvas(e);if(null==selectedElement){if($(e.target).parent().find(".cursorDiv").length){var s=$(e.target).parent().find(".cursorDiv").width(),o=$(e.target).parent().find(".cursorDiv").height(),n=$(e.target).parent().find(".cursorDiv").position().left,i=$(e.target).parent().find(".cursorDiv").position().top;t.y>i-3&&t.y<i+o+3&&t.x>n-3&&t.x<n+s+3?($(".eventCanvas").css("cursor","default"),t.y>i-3&&t.y<i+3&&t.x>n-3&&t.x<n+3&&$(".eventCanvas").css("cursor","nw-resize"),t.y>i+o-3&&t.y<i+o+3&&t.x>n-3&&t.x<n+3&&$(".eventCanvas").css("cursor","sw-resize"),t.y>i+3&&t.y<i+o-3&&t.x>n-3&&t.x<n+3&&$(".eventCanvas").css("cursor","w-resize"),t.y>i-3&&t.y<i+3&&t.x>n+3&&t.x<n+s-3&&$(".eventCanvas").css("cursor","n-resize"),t.y>i-3&&t.y<i+3&&t.x>n+s-3&&t.x<n+s+3&&$(".eventCanvas").css("cursor","ne-resize"),t.y>i+o-3&&t.y<i+o+3&&t.x>n+s-3&&t.x<n+s+3&&$(".eventCanvas").css("cursor","se-resize"),t.y>i+3&&t.y<i+o-3&&t.x>n+s-3&&t.x<n+s+3&&$(".eventCanvas").css("cursor","e-resize"),t.y>i+o-3&&t.y<i+o+3&&t.x>n+3&&t.x<n+s-3&&$(".eventCanvas").css("cursor","s-resize")):$(".eventCanvas").css("cursor","default")}}else{var r=t.x-mouseDownInit.x+selectedElementInit.left,u=t.y-mouseDownInit.y+selectedElementInit.top;$(".cursorDiv").css("left",r),$(".cursorDiv").css("top",u)}}}),$(document).on("mouseup",".eventCanvas",function(e){3!=e.which&&ItemEditMode==e_ItemEditMode_None&&(selectedElement&&(selectedElement.css("left",$(".cursorDiv").css("left")),selectedElement.css("top",$(".cursorDiv").css("top"))),clearMouseSelect())}),$(document).on("mouseout",".eventCanvas",function(e){ItemEditMode==e_ItemEditMode_None&&(selectedElement&&(selectedElement.css("left",$(".cursorDiv").css("left")),selectedElement.css("top",$(".cursorDiv").css("top"))),clearMouseSelect())}),$(document).on("dblclick",".eventCanvas",function(e){if(ItemEditMode==e_ItemEditMode_None){var t=mousePointToCanvas(e);$($(this).parent().find(".Item").get().reverse()).each(function(){if(null==focusElement){if("true"!=$(this).attr("contenteditable"))return;t.y>$(this).position().top&&t.y<$(this).position().top+$(this).height()&&t.x>$(this).position().left&&t.x<$(this).position().left+$(this).width()&&(focusElement=$(this),tempFucusElementChildElement=[],focusElement.find("input[type=hidden]").each(function(){tempFucusElementChildElement.push($(this))}))}}),focusElement&&focusElement.hasClass("text")&&(focusElement.focus(),focusElement.css("z-index",999999))}});
$(document).on("mousedown",".eventCanvas",function(t){if(ItemEditMode==e_ItemEditMode_Text){mouseDownInit=mousePointToCanvas(t);createRect($(t.target))}}),$(document).on("mousemove",".eventCanvas",function(t){if(ItemEditMode==e_ItemEditMode_Text&&null!=mouseDownInit.x){var e=mousePointToCanvas(t),n=e.x-mouseDownInit.x,i=e.y-mouseDownInit.y;n>0?$(t.target).parent().find(".cursorDiv").css("width",n):($(t.target).parent().find(".cursorDiv").css("left",mouseDownInit.x+n),$(t.target).parent().find(".cursorDiv").css("width",Math.abs(n))),i>0?$(t.target).parent().find(".cursorDiv").css("height",i):($(t.target).parent().find(".cursorDiv").css("top",mouseDownInit.y+i),$(t.target).parent().find(".cursorDiv").css("height",Math.abs(i)))}}),$(document).on("mouseup",".eventCanvas",function(t){if(ItemEditMode==e_ItemEditMode_Text){var e=$(t.target).parent().find(".cursorDiv").css("width"),n=$(t.target).parent().find(".cursorDiv").css("height"),i=$(t.target).parent().find(".cursorDiv").css("left"),a=$(t.target).parent().find(".cursorDiv").css("top"),r=0;$(t.target).parent().find(".ItemContainer .Item").each(function(){r<parseInt($(this).find("input[name=Key]").val())&&(r=parseInt($(this).find("input[name=Key]").val()))}),r++;for(var o=$("<div/>",{"class":"Item text ItemKey_"+r,style:"left:"+i+"; top:"+a+"; width:"+e+"; height:"+n+";",tabindex:r,contenteditable:"true"}),s=0;s<itemProperty.length;s++)o.append($("<input />",{type:"hidden",name:itemProperty[s]}));o.find("input[name=IsSelectable]").val("true"),o.find("input[name=Height]").val(o.height()),$(t.target).parent().find(".ItemContainer").append(o),$(t.target).parent().find(".cursorDiv").remove(),ItemEditMode=e_ItemEditMode_None}});
var selectedElement=null,selectedLastElement=null,selectedElementInit={},focusElement=null,tempFucusElementChildElement=[],selectedContextElement=null,mouseCursorStyle=null,objectCursorInit={},mouseDownInit={},e_ItemEditMode_None=0,e_ItemEditMode_Cursor=1,e_ItemEditMode_Text=2,ItemEditMode=e_ItemEditMode_None;